{
  "hash": "09e54b136b32de63fd86c6ce56948365",
  "result": {
    "markdown": "---\ntitle: \"Marginal Models\"\nauthor: \"Biostatistics Working Group\"\nformat:\n  html:\n    mermaid:\n      theme: forest\n---\n\n## Overview\nMarginal models, often termed population-averaged models, are a statistical method used to analyze longitudinal or clustered data. A marginal model estimates the average effect of the independent variable(s) on the outcome while accounting for within-subject correlations. These models allow for the estimation of population-averaged effects, in contrast to subject-specific effects estimated by random-effects models. Similar to the GEE approach, marginal models account for correlations within repeated measures, but using a different estimation technique that does not account for subject-specific effects. Marginal models expand upon the general linear model, providing a repeated measures framework that is robust to non-normality and non-constant variance, and can handle unbalanced or unequally spaced data. The term marginal in this context is used to emphasize that the model for the mean response at each occasion depends only on the covariates of interest, and not on any random effects or previous responses. \n\n\n```{mermaid}\ngraph LR\nA(( )) -- Intercept --> B(( ))\nB -- Slope --> C(( ))\nC -- Quadratic --> D(( ))\n\nB -- Y1 --> E[square]\nC -- Y2 --> F[square]\nD -- Y3 --> G[square]\n```\n\n\n### When to use Longitudinal Marginal Models?\nYou should use longitudinal marginal models in the following scenario:\n\n1. You want to know: How the average response of a population changes over time or under different conditions.\n2. Your variable: Is measured repeatedly over time or under varying conditions.\n3. You have: Repeated measures that might be correlated, and you want to account for this correlation without specifying a full covariance structure.\n\n### Getting Started with Longitudinal Marginal Models\nIn this tutorial, we will introduce the concept of longitudinal marginal models and guide you through a simple example using a small dataset. By the end of this tutorial, you will be able to:\n\n1. Understand the basic concepts of longitudinal marginal models.\n2. Fit a marginal model to longitudinal data using an example dataset in R.\n3. Interpret the results and understand the implications of the longitudinal marginal model analysis.\n\n## Basic Example\nIn this tutorial, we will begin by generating a sample dataset directly within R to ensure everyone has the same starting point and can follow along without needing to download or access external files. This generated dataset will serve as our example throughout this tutorial. In your own analyses, you'll likely start by importing your own data.\n\nThe simulated dataset created for this example consists of scores on a single outcome variable (\"Job_Satisfaction\") for 500 individuals each measured at four time points: T1-T4. \n\n#### Create Example Dataset\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-2_63915af861bd59ffa8eb34c977f21172'}\n\n```{.r .cell-code}\n# This will create a dataset with 2000 rows (4 rows for each of the 500 individuals).\n\n# Setting the number of individuals for our sample data\nn <- 500\n\n# Specifying the desired correlation matrix for our data\ncor_matrix <- matrix(c(1, 0.30, 0.30, 0.30, \n                      0.30, 1, 0.30, 0.30, \n                      0.30, 0.30, 1, 0.30,\n                      0.30, 0.30, 0.30, 1),\n                      nrow=4)\n\n# Using Cholesky decomposition to generate correlated data\ncholesky <- chol(cor_matrix)\n\n# Generating correlated random data for 4 timepoints\nrandom_probs <- matrix(runif(n * 4), ncol=4)\ncorrelated_probs <- random_probs %*% cholesky\n\n# Convert the probabilities to binary outcomes (using 0.5 as the threshold)\nbinary_outcomes <- ifelse(correlated_probs > 0.5, 1, 0)\n\n# Converting the generated data into a structured data frame\ndata <- data.frame(\n  Individual = rep(1:n, each=4),\n  TimePoint = rep(c(\"T1\", \"T2\", \"T3\", \"T4\"), times=n),\n  Job_Satisfaction = as.vector(t(binary_outcomes))\n)\n```\n:::\n\n\n#### View Dataset\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-3_8440f913d52f2e248275fbece11095b1'}\n\n```{.r .cell-code}\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Individual\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"TimePoint\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Job_Satisfaction\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"T1\",\"3\":\"0\",\"_rn_\":\"1\"},{\"1\":\"1\",\"2\":\"T2\",\"3\":\"1\",\"_rn_\":\"2\"},{\"1\":\"1\",\"2\":\"T3\",\"3\":\"1\",\"_rn_\":\"3\"},{\"1\":\"1\",\"2\":\"T4\",\"3\":\"0\",\"_rn_\":\"4\"},{\"1\":\"2\",\"2\":\"T1\",\"3\":\"1\",\"_rn_\":\"5\"},{\"1\":\"2\",\"2\":\"T2\",\"3\":\"1\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Model Specification and Estimation\nTo specify a Longitudinal Marginal Model, we will employ the `geepack` (or `nlme`) package in R. These models are adept at examining changes over time while considering the non-independence of repeated measurements on the same subjects. In a marginal model, we aim to estimate average population effects, taking into account the correlations between repeated measures on the same individuals.\n\n#### Install and Load Necessary Libraries\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-4_9439835f6dedaab643879643c4784f43'}\n\n```{.r .cell-code}\nif (!(\"lme4\" %in% installed.packages())) install.packages(\"geepack\")\nlibrary(geepack)\n```\n:::\n\n\n#### Model\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-5_4a39138b545b739e39599612d223f4f4'}\n\n```{.r .cell-code}\n# Fitting the longitudinal marginal model\nmodel <- geeglm(Job_Satisfaction ~ TimePoint, data = data, id = Individual, family = binomial(link = \"logit\"), corstr = \"exchangeable\")\n```\n:::\n\n\n#### Model Summary\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-6_1ed6d1de9833aa26aee259ca5bf1923e'}\n\n```{.r .cell-code}\nprint(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\ngeeglm(formula = Job_Satisfaction ~ TimePoint, family = binomial(link = \"logit\"), \n    data = data_large, id = Individual, corstr = \"exchangeable\")\n\nCoefficients:\n(Intercept) TimePointT2 TimePointT3 TimePointT4 \n -0.2900158   0.7795640   1.2344774   1.8063633 \n\nDegrees of Freedom: 2000 Total (i.e. Null);  1996 Residual\n\nScale Link:                   identity\nEstimated Scale Parameters:  [1] 1\n\nCorrelation:  Structure = exchangeable    Link = identity \nEstimated Correlation Parameters:\n    alpha \n0.1469716 \n\nNumber of clusters:   500   Maximum cluster size: 4 \n```\n:::\n:::\n\n::: {.cell hash='5_Tutorials_MarginalModels_cache/html/unnamed-chunk-7_ddb08ea69fcd48913c49811acb177594'}\n\n:::\n\n\n### Interpreting the Results\nA marginal model was fitted using the Generalized Estimating Equations (GEE) approach to assess the effect of `TimePoint` on `Job_Satisfaction` while accounting for the correlation of observations within individuals. The model used an exchangeable correlation structure, assuming that observations within the same individual have the same correlation. The output of the `geeglm` function provides estimates for the coefficients, along with their standard errors, Wald statistics, and p-values. The coefficient for `TimePoint` indicates how the log odds of Job Satisfaction change from one time point to another. If the p-value associated with this coefficient is less than 0.05, it suggests that there is a statistically significant change in Job Satisfaction across the time points. For a more detailed interpretation, we would look at the specific values obtained from the `print(model)` output, such as:\n\n- Coefficient (Estimate) for `TimePoint`: 0.657\n- Associated p-value: 0)\n\n## Conclusion\nIf the p-value for the `TimePoint` coefficient is less than 0.05, we conclude that there is a statistically significant change in `Job_Satisfaction` scores between the time points. Otherwise, there is no significant change based on the marginal model results. The exact nature (increase/decrease) of the change can be inferred from the sign (+/-) of the coefficient.\n\n\n\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}